
<div class="row">
  <div class="col-2 content-left-border-right">
    <h4><u>Vernal Pool Atlas</u></h4>

<form [formGroup]="filterForm">

    <fieldset id="poolStatus"> <!-- for radio-button grouping -->
    <table class="table table-sm">
      <th style="width: 70%;"></th>
      <th style="width: 30%;"></th>
<!--
      <tr *ngIf="userIsAdmin">
        <td>
          <label>
            <input checked formControlName="mappedPoolStatus" type="radio" value="All" (change)="setStatusLoadPools('')" class="radio-button-justify-left" />
            <span>All Data</span>
          </label>
        </td>
        <td>{{stats.total_data}}</td>
      </tr>
-->
      <tr>
        <td>
          <label>
            <input checked formControlName="mappedPoolStatus" type="radio" value="All" (change)="setStatusLoadPools('')" class="radio-button-justify-left" />
            <span>All Pools</span>
          </label>
        </td>
        <td>{{stats.total}}</td>
      </tr>

      <tr>
        <td>
          <label>
            <input formControlName="mappedPoolStatus" type="radio" value="Potential" (change)="setStatusLoadPools('Potential')" class="radio-button-justify-left" />
            <span>Potential</span>
          </label>
        </td>
        <td>{{stats.potential}}</td>
      </tr>

      <tr>
        <td>
          <label>
            <input formControlName="mappedPoolStatus" type="radio" value="Probable" (change)="setStatusLoadPools('Probable')" class="radio-button-justify-left" />
            <span>Probable</span>
          </label>
        </td>
        <td>{{stats.probable}}</td>
      </tr>

      <tr>
        <td>
          <label>
            <input formControlName="mappedPoolStatus" type="radio" value="Confirmed" (change)="setStatusLoadPools('Confirmed')" class="radio-button-justify-left" />
            <span>Confirmed</span>
          </label>
        </td>
        <td>{{stats.confirmed}}</td>
      </tr>

      <tr *ngIf="userIsAdmin">
        <td><label>
            <input formControlName="mappedPoolStatus" type="radio" value="Eliminated" (change)="setStatusLoadPools('Eliminated')" class="radio-button-justify-left" />
            <span>Eliminated</span>
        </label></td>
        <td>{{stats.eliminated}}</td>
      </tr>

      <tr *ngIf="userIsAdmin">
        <td><label>
            <input formControlName="mappedPoolStatus" type="radio" value="Duplicate" (change)="setStatusLoadPools('Duplicate')" class="radio-button-justify-left" />
            <span>Duplicate</span>
        </label></td>
        <td>{{stats.duplicate}}</td>
      </tr>

      <tr *ngIf="userIsAdmin">
        <td>
          <label>
            <input formControlName="mappedPoolStatus" type="radio" value="Visited" (change)="setStatusLoadPools('Visited')" class="radio-button-justify-left" />
            <span>Visited</span>
          </label>
        </td>
        <td>{{stats.visited}}</td>
      </tr>

      <tr>
        <td>
          <label [ngClass]="{ 'disabled':true }">
            <input disabled formControlName="mappedPoolStatus" type="radio" value="Monitored" class="radio-button-justify-left" />
            <span [ngClass]="{ 'disabled':true }">Monitored</span>
          </label>
        </td>
        <td>{{stats.monitored}}</td>
      </tr>

    </table>

    </fieldset>

</form>

    <h4><u>Search Pools/Visits</u></h4>
    <!--
    There's a performance issue here with search filters:
    - use keyup if the result set is small (<100)
    - use keyup.enter and keyup.tab otherwise
    - to be safe, do the latter
    -->
    <form [formGroup]="filterForm">
      <table class="table table-sm"> <!-- odd discovery: table without <tr>, <td> does nice things -->
        <th style="width: 50%;"></th>
        <th style="width: 50%;"></th>
        <tr class="form-group">
          <td for="visitId">Visit ID</td>
          <td>
            <input (change)="loadPools(1)" type="text" formControlName="visitId" class="form-control"/>
          </td>
        </tr>
        <tr class="form-group">
          <td for="poolId">Pool ID</td>
          <td>
            <input (change)="loadPools(1)" type="text"  formControlName="poolId" class="form-control"/>
          </td>
        </tr>
        <tr class="form-group">
          <td for="userName">User</td>
          <td>
            <input (change)="loadPools(1)" formControlName="userName" class="form-control"/>
          </td>
        </tr>
        <tr class="form-group">
          <td for="town">Town</td>
          <td>
            <input (change)="loadPools(1)" formControlName="town" class="form-control"/>
          </td>
        </tr>
        <tr class="form-group">
          <td>Method</td>
          <td>
            <select (change)="loadPools(1)" formControlName="mappedMethod" class="form-control">
              <option value="">All</option>
              <option value="Aerial">Aerial</option>
              <option value="Known">Known</option>
              <option value="Visit">Visit</option>
            </select>
          </td>
        </tr>
      </table>
    </form>
  </div> <!-- col-2 -->

  <div class="col-10">
    <div *ngIf="!loading">
      <div class="row">
        <div> <!-- OMFG, all vertical alignment issues were due to different div levels!!! -->
          <button (click)="checkBoxSetValue(true)" class="btn btn-link">{{count}} Records</button>
          <button *ngIf="!mapView" (click)="showMap()" class="btn btn-link">Map View</button>
          <button *ngIf="mapView" (click)="showTable()" class="btn btn-link">Table View</button>
        </div>
        <label class="btn btn-link vert-align-mid" style="vertical-align:bottom;">
          <input [checked]="loadAllRec" (change)="checkBoxValueChanged($event)" type="checkbox" class="radio-button-justify-left"/>
          <span>Load All</span>
        </label>
        <span *ngIf="!loadAllRec">
          <button (click)="firstPage()" class="btn btn-link">|< First</button>
          <button (click)="prevPage()" class="btn btn-link"><< Prev</button>
          <button class="btn btn-link">Page {{page}}</button>
          <button (click)="nextPage()" class="btn btn-link">Next >></button>
          <button (click)="lastPage()" class="btn btn-link">Last >|</button>
        </span>
      </div>

      <div *ngIf="!mapView" class="container-fluid">
        <table class="table table-sm table-responsive vce-table-sm" style="width:105%">
          <div style="height:550px; overflow:auto;">
          <thead>
            <tr>
                <th class="body-scroll-align-columns">Pool</th>
                <th class="body-scroll-align-columns">Mapped By</th>
                <th class="body-scroll-align-columns">Mapped Town</th>
                <th class="body-scroll-align-columns">Method</th>
                <th class="body-scroll-align-columns">Status</th>
                <th class="body-scroll-align-columns">Mapped Lat</th>
                <th class="body-scroll-align-columns">Mapped Lng</th>

                <th class="body-scroll-align-columns">Visit</th>
                <th class="body-scroll-align-columns">Visit User</th>
                <th class="body-scroll-align-columns">Visit Date</th>
                <th class="body-scroll-align-columns">Vernal Pool?</th>
                <th class="body-scroll-align-columns">Visit Lat</th>
                <th class="body-scroll-align-columns">Visit Lng</th>
              </tr>
          </thead>
          <!--
          <div style="width: 100%; height: 550px; overflow: scroll;">
          -->
          <tbody>
            <tr *ngFor="let pool of pools">
                <!--
                <td class="vert-aligned body-scroll-align-columns"><a [routerLink]="['/pools/mapped/view/', pool.mappedPoolId]" class="btn btn-link">{{pool.mappedPoolId}}</a></td>
                -->
                <td title="Add a visit for pool {{pool.mappedPoolId}}" class="vert-aligned body-scroll-align-columns"><a [routerLink]="['/pools/visit/create/', pool.mappedPoolId]" class="btn btn-link">{{pool.mappedPoolId}}</a></td>
                <td class="vert-aligned body-scroll-align-columns">{{pool.mappedByUser}}</td>
                <td class="vert-aligned body-scroll-align-columns">{{pool.mappedTown.townName}}</td>
                <td class="vert-aligned body-scroll-align-columns">{{pool.mappedMethod}}</td>
                <td class="vert-aligned body-scroll-align-columns">{{pool.mappedPoolStatus}}</td>
                <td class="vert-aligned body-scroll-align-columns">{{pool.mappedLatitude}}</td>
                <td class="vert-aligned body-scroll-align-columns">{{pool.mappedLongitude}}</td>

                <span *ngIf="pool.visitId">
                  <td title="View visit {{pool.visitId}}" class="vert-aligned body-scroll-align-columns"><a [routerLink]="['/pools/visit/view/', pool.visitId]" class="btn btn-link">{{pool.visitId}}</a></td>
                </span>
                <span *ngIf="!pool.visitId">
                  <td class="vert-aligned body-scroll-align-columns"></td>
                </span>
                <td class="vert-aligned body-scroll-align-columns">{{pool.visitUserName}}</td>
                <td class="vert-aligned body-scroll-align-columns">{{pool.visitDate}}</td>
                <td class="vert-aligned body-scroll-align-columns">{{pool.visitVernalPool}}</td>
                <td class="vert-aligned body-scroll-align-columns">{{pool.visitLatitude}}</td>
                <td class="vert-aligned body-scroll-align-columns">{{pool.visitLongitude}}</td>
            </tr>
          </tbody>
        </div>
        </table>
      </div>

      <div *ngIf="mapView">
        <app-map-comp
          [mapPoints]="mapPoints"
          [mapValues]="pools"
          [itemType]="itemType">
        </app-map-comp>
      </div>

    </div> <!-- loading -->

    <div *ngIf="loading">
      ...Loading
    </div>

  </div><!-- col-10 -->

</div><!-- row -->
